Description: CVE-2016-2099: Use-after-free in heap on specially crafted XML input
Origin: upstream, https://issues.apache.org/jira/browse/XERCESC-2066
Bug: https://issues.apache.org/jira/browse/XERCESC-2066
Bug-Debian: https://bugs.debian.org/823863
Forwarded: not-needed
Author: Salvatore Bonaccorso <carnil@debian.org>
Reviewed-by: Salvatore Bonaccorso <carnil@debian.org>
Last-Update: 2016-05-14
---

--- a/src/xercesc/validators/DTD/DTDScanner.cpp
+++ b/src/xercesc/validators/DTD/DTDScanner.cpp
@@ -2509,7 +2509,15 @@ void DTDScanner::scanExtSubsetDecl(const
         {
             while (true)
             {
-                const XMLCh nextCh = fReaderMgr->peekNextChar();
+                XMLCh nextCh;
+
+                try {
+                    nextCh = fReaderMgr->peekNextChar();
+                }
+                catch (XMLException& ex) {
+                    fScanner->emitError(XMLErrs::XMLException_Fatal, ex.getCode(), ex.getMessage(), NULL, NULL);
+                    nextCh = chNull;
+                }
 
                 if (!nextCh)
                 {
