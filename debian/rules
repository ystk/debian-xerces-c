#!/usr/bin/make -f

VERSION := $(shell dpkg-parsechangelog | \
             awk '/Version:/ {print $$2}' | cut -d- -f 1 | sed -e 's/~/./g')

# Variables used by cdbs
DEB_TAR_SRCDIR = xerces-c-$(VERSION)
DEB_COMPRESS_EXCLUDE = examples html

# Include cdbs rules files.
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk

# This disables explicit passing of -msse2 to gcc.  It does not
# actually disable sse2 extensions for platforms such as x86_64
# (amd64) which enable sse2 extensions by default.
DEB_CONFIGURE_EXTRA_FLAGS = --disable-sse2

# As 0.4.21, cdbs creates but doesn't debian/compat.  It creates it
# conditionally, so this doesn't have a trivial fix.
clean::
	$(RM) debian/compat *.cdbs-config_list
	$(RM) debian/stamp-samples

post-patches:: debian/stamp-samples
debian/stamp-samples:
	-$(RM) -r $(DEB_SRCDIR)/samples.clean
	cp -a $(DEB_SRCDIR)/samples $(DEB_SRCDIR)/samples.clean
	touch debian/stamp-samples

install/libxerces-c-dev::
	mkdir -p debian/tmp/usr/share/doc/libxerces-c-dev
	cp -a $(DEB_SRCDIR)/samples.clean \
		debian/tmp/usr/share/doc/libxerces-c-dev/examples

install/libxerces-c-doc::
	mkdir -p debian/tmp/usr/share/doc/libxerces-c-doc
	cp -a $(DEB_SRCDIR)/doc/html \
		debian/tmp/usr/share/doc/libxerces-c-doc/html

install/libxerces-c-samples::
	perl debian/misc/create_missing_manual_pages

# Install lintian override files
binary-post-install/%::
	if [ -f debian/$*.lintian ]; then \
	    mkdir -p debian/$*/usr/share/lintian/overrides && \
	    cp -p debian/$*.lintian debian/$*/usr/share/lintian/overrides/$*; \
	fi
